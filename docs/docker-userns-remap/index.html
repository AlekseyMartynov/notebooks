<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width">
    <meta name="theme-color" content="#000000">
    <title>Docker: user namespaces</title>
    <link rel="canonical" href="https://alekseymartynov.github.io/notebooks/docker-userns-remap/">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,300,600&subset=latin,greek,cyrillic,latin-ext">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="/notebooks/style.css">
    <meta property="og:description" content="–° —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –î–æ–∫–µ—Ä–∞, –æ–±–µ—Å–ø–æ–∫–æ–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –≤–æ–ª–Ω–æ–≤–∞–ª —Ç–æ—Ç —Ñ–∞–∫—Ç, —á—Ç–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≥—Ä—É–ø–ø –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å –Ω—É–ª—è. –ò–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏, root –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Ä–∞–≤–Ω–æ—Å–∏–ª–µ–Ω root-—É –≤–æ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–µ. –ò –¥–∞–∂–µ –Ω–∞—à–ª–∏—Å—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–Ω–µ —Å–∞–º—ã–µ —Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã–µ‚Ä¶">
    <meta property="og:type" content="article">
    <meta name="robots" content="noarchive">
    <script>
        /p=\d/.test(location.search) && document.write("<script src=/notebooks/legacy-id-redirect.js><\/script>");
    </script>
    <!-- Trackers place -->
</head>
<body>
    <div id="page">
        <div id="header">
            <div id="headerimage">
                <h1><a href="/notebooks/">AM&#x27;s Notebooks</a></h1>
                <div class="description">Misc tech notes</div>
            </div>
        </div>
        <hr class="plainscape">
        <div id="wrapper" class="hasfloats">
            <div id="content">
                
<div class="post" style="min-height: 250px">
    <h2><a href="/notebooks/docker-userns-remap/" rel="bookmark">Docker: user namespaces</a></h2>
    <div class="postmetadata">
20.03.2016 &bull; blog.amartynov.ru archive    </div>
    <div class="entry"><p>–° —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –î–æ–∫–µ—Ä–∞, –æ–±–µ—Å–ø–æ–∫–æ–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –≤–æ–ª–Ω–æ–≤–∞–ª —Ç–æ—Ç —Ñ–∞–∫—Ç, —á—Ç–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≥—Ä—É–ø–ø –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å –Ω—É–ª—è. –ò–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏, <code>root</code> –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Ä–∞–≤–Ω–æ—Å–∏–ª–µ–Ω <code>root</code>-—É –≤–æ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–µ. –ò –¥–∞–∂–µ <a href="https://redd.it/316znt" target="_blank">–Ω–∞—à–ª–∏—Å—å —Å—Ü–µ–Ω–∞—Ä–∏–∏</a> (–Ω–µ —Å–∞–º—ã–µ —Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã–µ, –∫–æ–Ω–µ—á–Ω–æ), –≤ –∫–æ—Ç–æ—Ä—ã—Ö <code>root</code> –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –Ω–∞—Ä—É–∂—É.</p>
<p>–í Docker 1.10 –¥–æ–±–∞–≤–∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º—ã—Ö <a href="https://docs.docker.com/engine/security/userns-remap/" target="_blank">user namespaces</a>, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–∑–≤–∞–Ω—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å —ç—Ç—É —Å–∏—Ç—É–∞—Ü–∏—é.</p>
<h3>–ù—É–∂–Ω–æ –ª–∏ —Å–∫–æ—Ä–µ–µ –±–µ–∂–∞—Ç—å –∏ –≤–∫–ª—é—á–∞—Ç—å –∏—Ö —É —Å–µ–±—è?</h3>
<p>–ù–µ —Å–ø–µ—à–∏—Ç–µ! –í–æ –≤—Å–µ–π —ç—Ç–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –∑–ª–æ–≤—Ä–µ–¥–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ö–æ—á–µ—Ç –∞—Ç–∞–∫–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω—é—é —Å–∏—Å—Ç–µ–º—É. –¢–∞–∫–æ–µ –≤–æ–∑–º–æ–∂–Ω–æ –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö —Ö–æ—Å—Ç–∏–Ω–≥–∞ –∏ –∞—Ä–µ–Ω–¥—ã. –ï—Å–ª–∏ –∂–µ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Docker —Å–∞–º–∏ –∏ –Ω–∞ —Å–≤–æ–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö, —Ç–æ, –∫–æ–Ω–µ—á–Ω–æ –∂–µ, –Ω–µ –±—É–¥–µ—Ç–µ —ç—Ç–æ–≥–æ –¥–µ–ª–∞—Ç—å, –∞ –Ω–∞–æ–±–æ—Ä–æ—Ç –±—É–¥–µ—Ç–µ —Å–æ–±–ª—é–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤. ‚Äú–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π‚Äù <code>root</code> –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—Ç —Ç–∞–∫–æ–≥–æ –∂–µ –±–µ—Ä–µ–∂–Ω–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫–∞–∫ –∏ –≤–Ω–µ—à–Ω–∏–π.</p>
<span id="more"></span>
<h3>–í–Ω–∏–º–∞–Ω–∏–µ: –≥–ª–æ–±–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞!</h3>
<p>User namespaces ‚Äî –Ω–µ —Ç–∞ –æ–ø—Ü–∏—è, —Å –∫–æ—Ç–æ—Ä–æ–π –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –ø–æ–±–∞–ª–æ–≤–∞—Ç—å—Å—è. –ò–∑-–∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π (–∞ –∏–º–µ–Ω–Ω–æ ‚Äî –∏–∑-–∑–∞ –∂–µ–ª–∞–Ω–∏—è –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —ç—Ç–∏–º –∫–æ–ø–∏—è–º <code>chown</code>) –≤–∫–ª—é—á–µ–Ω–∏–µ, –≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ user namespaces –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç —Ä–µ—Å—Ç–∞—Ä—Ç Docker engine, –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã—Ç—è–≥–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–±—Ä–∞–∑–æ–≤ –∏, –∫–∞–∫ —Å–ª–µ–¥—Å—Ç–≤–∏–µ, –∑–∞–ø—É—Å–∫ —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.</p>
<h3>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h3>
<p>–ò—Ç–∞–∫, –ø–æ–ª–µ–∑–ª–∏ –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ–±—Ä–∏.</p>
<p>–í —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –õ–∏–Ω—É–∫—Å–∞—Ö –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≥—Ä—É–ø–ø, —á—å–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø–æ–ø–∞–¥–∞—é—Ç –≤ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã <code>UID_MIN - UID_MAX</code> –∏ <code>GID_MIN - GID_MAX</code> —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –≤—ã–¥–µ–ª—è—é—Ç—Å—è –¥–∏–∞–ø–∞–∑–æ–Ω—ã –∏–∑ <code>SUB_UID_COUNT</code> –∏ <code>SUB_GID_COUNT</code> —à—Ç—É–∫ —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º—ã—Ö subordinate-–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤. –û–Ω–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª—ã <a href="https://man7.org/linux/man-pages/man5/subuid.5.html" target="_blank"><code>/etc/subuid</code></a> –∏ <a href="https://man7.org/linux/man-pages/man5/subgid.5.html" target="_blank"><code>/etc/subgid</code></a>, –∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç <code>SUB_UID_MIN</code> –¥–æ <code>SUB_UID_MAX</code> –∏ –æ—Ç <code>SUB_GID_MIN</code> –¥–æ <code>SUB_GID_MAX</code>. –ö—Ç–æ –Ω–µ –ø–æ–Ω—è–ª ‚Äî —è –Ω–µ –≤–∏–Ω–æ–≤–∞—Ç üòÉ</p>
<p>–ó–Ω–∞—á–µ–Ω–∏—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç –º–æ–∂–Ω–æ –ø–æ–¥—Å–º–æ—Ç—Ä–µ—Ç—å –≤ <a href="https://man7.org/linux/man-pages/man8/useradd.8.html" target="_blank"><code>man useradd</code></a>.</p>
<p>–í–æ—Ç —Ç–∞–∫ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ñ–∞–π–ª <code>/etc/subuid</code>:</p>
<pre><code class="nohighlight">user1:100000:65536
user2:165536:65536
</code></pre>
<p>–î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ user namespaces Docker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º <code style="white-space: nowrap">--userns-remap=user</code> (–µ—Å–ª–∏ <code>user</code> –æ–ø—É—Å—Ç–∏—Ç—å –∏–ª–∏ –∑–∞–¥–∞—Ç—å –≤ <code>default</code>, —Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å —Å –∏–º–µ–Ω–µ–º <code>dockremap</code>).</p>
<p><strong>–°—É—Ç—å:</strong> <code>subuid</code> –∏ <code>subgid</code> —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç –ø—Ä–∏–±–∞–≤–ª—è—Ç—å—Å—è –∫–æ –≤—Å–µ–º <code>uid</code> –∏ <code>gid</code> –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.</p>
<p>–ü–∞–ø–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –î–æ–∫–µ—Ä–∞ –ø–µ—Ä–µ–µ–¥–µ—Ç –∏–∑ <code>/var/lib/docker</code> –≤ <code>/var/lib/docker/(subuid):(subgid)</code>.</p>
<p><code>root</code> –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –¥–ª—è –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –∫–∞–∫ subordinate-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å ‚Äú—Ä—É—Ç–æ–≤–∞–Ω–∏—è‚Äù –Ω–∞—Ä—É–∂—É –±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∞. (–£—Ä–∞!)</p>
<h3>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h3>
<p>User namespaces –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –¥—Ä—É–≥–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ (—Å–º. <a href="https://docs.docker.com/engine/security/userns-remap/#user-namespace-known-limitations" target="_blank">User namespace known limitations</a>) –∏ –æ—Å–ª–æ–∂–Ω—è—é—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π (—Å–º. <a href="https://stackoverflow.com/q/35291520" target="_blank">–æ–±—Å—É–∂–¥–µ–Ω–∏–µ –Ω–∞ StackOverflow</a>).</p>
</div>
</div>

<div id="disqus_thread"></div>

<div class="prevnext hasfloats">
    <div class="prev">
        <a rel="prev" href="/notebooks/–∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è-–∏–ª–∏-—Ñ–∏–ª—å—Ç—Ä/">&#9666; –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä?</a>
    </div>
    <div class="next">
        <a rel="next" href="/notebooks/docker-containerd-runc-runv/">Docker: containerd, runC, runV –∏ –≤ –æ–±—â–µ–º –ø—Ä–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É &#9656;</a>
    </div>
</div>


            </div>
        </div>
        <hr class="plainscape">
        <div id="footer">
            <p>
                –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö –ª–∏—Ü–µ–Ω–∑–∏–∏
                <a rel="license" href="https://creativecommons.org/licenses/by/3.0/deed.ru" target="_blank">Creative Commons Attribution 3.0 Unported</a>.
            </p>
            <p>
                Proudly hosted by <a href="https://m.do.co/c/8183daf27a39" rel="nofollow" target="_blank">DigitalOcean</a>
            </p>
        </div>
    </div>


    <script>
        addEventListener("DOMContentLoaded", function() {
        });
    </script>

</body>
</html>
